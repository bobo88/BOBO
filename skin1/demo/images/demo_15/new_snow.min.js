Date.now||(Date.now=function(){return(new Date).getTime()}),function(){"use strict";for(var a=["webkit","moz"],b=0;b<a.length&&!window.requestAnimationFrame;++b){var c=a[b];window.requestAnimationFrame=window[c+"RequestAnimationFrame"],window.cancelAnimationFrame=window[c+"CancelAnimationFrame"]||window[c+"CancelRequestAnimationFrame"]}if(/iP(ad|hone|od).*OS 6/.test(window.navigator.userAgent)||!window.requestAnimationFrame||!window.cancelAnimationFrame){var d=0;window.requestAnimationFrame=function(a){var b=Date.now(),c=Math.max(d+16,b);return setTimeout(function(){a(d=c)},c-b)},window.cancelAnimationFrame=clearTimeout}}(),function(a){a.snowfall=function(b,c){function g(d,e,g,h){this.x=d,this.y=e,this.size=g,this.speed=h,this.step=0,this.stepSize=f(1,10)/100,c.collection&&(this.target=n[f(0,n.length-1)]);var l=null;c.image?(l=document.createElement("img"),l.src=c.image):(l=document.createElement("div"),a(l).css({background:c.flakeColor})),a(l).attr({"class":"snowfall-flakes"}).css({width:this.size,height:this.size,position:c.flakePosition,top:this.y,left:this.x,fontSize:0,zIndex:c.flakeIndex}),a(b).get(0).tagName===a(document).get(0).tagName?(a("body").append(a(l)),b=a("body")):a(b).append(a(l)),this.element=l,this.update=function(){if(this.y+=this.speed,this.y>i-(this.size+6)&&this.reset(),this.element.style.top=this.y+"px",this.element.style.left=this.x+"px",this.step+=this.stepSize,u===!1?this.x+=Math.cos(this.step):this.x+=u+Math.cos(this.step),c.collection&&this.x>this.target.x&&this.x<this.target.width+this.target.x&&this.y>this.target.y&&this.y<this.target.height+this.target.y){var a=this.target.element.getContext("2d"),b=this.x-this.target.x,d=this.y-this.target.y,e=this.target.colData;if(void 0!==e[parseInt(b)][parseInt(d+this.speed+this.size)]||d+this.speed+this.size>this.target.height)if(d+this.speed+this.size>this.target.height){for(;d+this.speed+this.size>this.target.height&&this.speed>0;)this.speed*=.5;a.fillStyle="#fff",void 0==e[parseInt(b)][parseInt(d+this.speed+this.size)]?(e[parseInt(b)][parseInt(d+this.speed+this.size)]=1,a.fillRect(b,d+this.speed+this.size,this.size,this.size)):(e[parseInt(b)][parseInt(d+this.speed)]=1,a.fillRect(b,d+this.speed,this.size,this.size)),this.reset()}else this.speed=1,this.stepSize=0,parseInt(b)+1<this.target.width&&void 0==e[parseInt(b)+1][parseInt(d)+1]?this.x++:parseInt(b)-1>0&&void 0==e[parseInt(b)-1][parseInt(d)+1]?this.x--:(a.fillStyle="#fff",a.fillRect(b,d,this.size,this.size),e[parseInt(b)][parseInt(d)]=1,this.reset())}(this.x+this.size>j-k||this.x<k)&&this.reset()},this.reset=function(){this.y=0,this.x=f(k,j-k),this.stepSize=f(1,10)/100,this.size=f(100*c.minSize,100*c.maxSize)/100,this.element.style.width=this.size+"px",this.element.style.height=this.size+"px",this.speed=f(c.minSpeed,c.maxSpeed)}}function v(){for(h=0;h<d.length;h+=1)d[h].update();l=requestAnimationFrame(function(){v()})}var d=[],e={flakeCount:35,flakeColor:"#ffffff",flakePosition:"absolute",flakeIndex:999999,minSize:1,maxSize:2,minSpeed:1,maxSpeed:5,round:!1,shadow:!1,collection:!1,collectionHeight:40,deviceorientation:!1},c=a.extend(e,c),f=function(a,b){return Math.round(a+Math.random()*(b-a))};a(b).data("snowfall",this);var h=0,i=a(b).height(),j=a(b).width(),k=0,l=0;if(c.collection!==!1){var m=document.createElement("canvas");if(m.getContext&&m.getContext("2d"))for(var n=[],o=a(c.collection),p=c.collectionHeight,h=0;h<o.length;h++){var q=o[h].getBoundingClientRect(),r=a("<canvas/>",{"class":"snowfall-canvas"}),s=[];if(q.top-p>0){a("body").append(r),r.css({position:c.flakePosition,left:q.left+"px",top:q.top-p+"px"}).prop({width:q.width,height:p});for(var t=0;t<q.width;t++)s[t]=[];n.push({element:r.get(0),x:q.left,y:q.top-p,width:q.width,height:p,colData:s})}}else c.collection=!1}for(a(b).get(0).tagName===a(document).get(0).tagName&&(k=25),a(window).bind("resize",function(){i=a(b)[0].clientHeight,j=a(b)[0].offsetWidth}),h=0;h<c.flakeCount;h+=1)d.push(new g(f(k,j-k),f(0,i),f(100*c.minSize,100*c.maxSize)/100,f(c.minSpeed,c.maxSpeed)));c.round&&a(".snowfall-flakes").css({"-moz-border-radius":c.maxSize,"-webkit-border-radius":c.maxSize,"border-radius":c.maxSize}),c.shadow&&a(".snowfall-flakes").css({"-moz-box-shadow":"1px 1px 1px #555","-webkit-box-shadow":"1px 1px 1px #555","box-shadow":"1px 1px 1px #555"});var u=!1;c.deviceorientation&&a(window).bind("deviceorientation",function(a){u=.1*a.originalEvent.gamma}),v(),this.clear=function(){a(".snowfall-canvas").remove(),a(b).children(".snowfall-flakes").remove(),cancelAnimationFrame(l)}},a.fn.snowfall=function(b){return"object"==typeof b||void 0==b?this.each(function(c){new a.snowfall(this,b)}):"string"==typeof b?this.each(function(b){var c=a(this).data("snowfall");c&&c.clear()}):void 0}}(jQuery);